# Payment Providers

You may integrate your application with as many payment providers as you wish. But first we must understand the basics of collecting & managing payments online and how Payavel can help integrate with multiple providers like Adyen, Stripe & Braintree, just to name a few.

## Overview

Payavel's approach to payment processing and management allows you to define your own api on top of a solid foundation that supports custom rules aligned with you application's standards.

Most of the integration you will be working on will take place within the provider gateway which can be generated by running the following command:

```bash
php artisan checkout:provider Adyen --id=adyen
```

The above example will generate `App/Services/Payment/AdyenPaymentRequest.php` & `App/Services/Payment/AdyenPaymentResponse.php` which will be responsible for making requests to Adyen and returning a standardized response.

Don't be overwhelmed, all that you need to do is integrate the gateway with the PSP, in other words, translate your application's API into the payment service provider's language. See [API Reference](/api) to get a better understanding of the methods that must be implemented.

## Configuration

In order for requests to be processed through the gateway we have created, it is important to register it in `config/payment.php` and assign it to at least one merchant.

```php

[

    'providers' => [

        'adyen' => [
            'name' => 'Adyen',
            'request_class' => App\Services\Payment\AdyenPaymentRequest::class,
            'response_class' => App\Services\Payment\AdyenPaymentResponse::class,
        ],

    ],

    'merchants' => [

        'company' => [
            'name' => 'Company',
            'providers' => [
                'adyen' => [
                    'merchant_account' => env('COMPANY_ADYEN_MERCHANT_ACCOUNT'),
                    'checkout_api_key' => env('COMPANY_ADYEN_CHECKOUT_API_KEY'),
                    'endpoint' => env('COMPANY_ADYEN_CHECKOUT_ENDPOINT'),
                ],
            ],
        ],

    ],

]

```

:::info Via the database driver
If you are leveraging the database driver, you may simply insert a new record into the `payment_providers` table & relate it to a merchant via the `payment_merchant_provider` table instead.
:::

## Setup

Within the `App\Services\Payment\AdyenPaymentRequest::class` you will find the `setUp()` function where it is recommended to initialize the client connection with the PSP.

```php

use Illuminate\Support\Facades\Http;
use Payavel\Checkout\PaymentRequest;

class AdyenPaymentRequest extends PaymentRequest
{
    /**
     * The merchant account variable to be passed into each request.
     *
     * @var string
     */
    protected $merchantAccount;

    /**
     * The configured Http client.
     *
     * @var \Illuminate\Http\Client\Factory
     */
    protected $client;

    /**
     * The environment specific endpoint.
     *
     * @var string
     */
    protected $endpoint;

    /**
     * Set up the request.
     *
     * @return void
     */
    protected function setUp()
    {
        $this->merchantAccount = config('payment.merchants.' . $this->merchant->getId() . '.providers.' . $this->provider->getId() . '.merchant_account');

        $this->client = HTTP::acceptJson()->withHeaders([
            'x-api-key' => config('payment.merchants.' . $this->merchant->getId() . '.providers.' . $this->provider->getId() . '.checkout_api_key'),
        ]);

        $this->endpoint = config('payment.merchants.' . $this->merchant->getId() . '.providers.' . $this->provider->getId() . '.endpoint');
    }
}

```
